{{ $project := .name }}
{{ range $name, $service := .services }}
{{ if $service.ports }}
---
#! {{ $name }}-service.yaml
# Generated code, do not edit
apiVersion: v1
kind: Service
metadata:
  name: {{ $name }}-published
  namespace: {{ $project }}
  labels:
    com.docker.compose.project: {{ $project }}
    com.docker.compose.service: {{ $name }}
spec:
  type: LoadBalancer
  selector:
    com.docker.compose.project: {{ $project }}
    com.docker.compose.service: {{ $name }}
  ports:
{{ range $port := $service.ports}}
    - name: {{ if $port.name }}{{ $port.name }}{{ else }}{{ $name }}-{{ $port.published }}{{ end }}
      port: {{ $port.published }}
      protocol:  {{ $port.protocol | uppercase }}
      targetPort: {{ $name }}-{{ $port.target }}
{{ end }}

{{ end }}
{{ end }}